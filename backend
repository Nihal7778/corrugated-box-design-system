//Customer.js
import React, { useState } from 'react';
import axios from 'axios';
import { Container, Typography, TextField, Button } from '@mui/material';

function AddCustomer() {
  const [customer, setCustomer] = useState({
    customer_code: '',
    company_name: '',
    rating: '',
    contact_person: '',
    phone_no: '',
    email: '',
    action: ''
  });

  const handleChange = (e) => {
    setCustomer({ ...customer, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      const response = await axios.post('http://localhost:5000/customers/add', customer);
      console.log(response.data);
      // Reset form
      setCustomer({
        customer_code: '',
        company_name: '',
        rating: '',
        contact_person: '',
        phone_no: '',
        email: '',
        action: ''
      });
    } catch (err) {
      console.error(err);
    }
  };

  return (
    <Container>
      <Typography variant="h4" gutterBottom>
        Add Customer
      </Typography>
      <form onSubmit={handleSubmit}>
        <TextField
          name="customer_code"
          label="Customer Code"
          value={customer.customer_code}
          onChange={handleChange}
          fullWidth
          margin="normal"
        />
        <TextField
          name="company_name"
          label="Company Name"
          value={customer.company_name}
          onChange={handleChange}
          fullWidth
          margin="normal"
        />
        <TextField
          name="rating"
          label="Rating"
          value={customer.rating}
          onChange={handleChange}
          fullWidth
          margin="normal"
        />
        <TextField
          name="contact_person"
          label="Contact Person"
          value={customer.contact_person}
          onChange={handleChange}
          fullWidth
          margin="normal"
        />
        <TextField
          name="phone_no"
          label="Phone No"
          value={customer.phone_no}
          onChange={handleChange}
          fullWidth
          margin="normal"
        />
        <TextField
          name="email"
          label="Email"
          value={customer.email}
          onChange={handleChange}
          fullWidth
          margin="normal"
        />
        <TextField
          name="action"
          label="Action"
          value={customer.action}
          onChange={handleChange}
          fullWidth
          margin="normal"
        />
        <Button type="submit" variant="contained" color="primary" fullWidth>
          Add Customer
        </Button>
      </form>
    </Container>
  );
}

export default AddCustomer;


//server.js
const express = require('express');
const cors = require('cors');
const { Pool } = require('pg');

const app = express();
const port = 5001; // Ensure this port is available

const corsOptions = {
  origin: 'http://localhost:3000',
};

// Middleware
app.use(cors(corsOptions)); // Use corsOptions here
app.use(express.json());

// PostgreSQL connection setup
const pool = new Pool({
  user: 'postgres',
  host: 'localhost',
  database: 'postgres',
  password: 'Mr.jamesbond007',
  port: 5432, // Default PostgreSQL port
});

// Test route
app.get('/', (req, res) => {
  res.send('Hello from Express!');
});

// POST route to fetch data from BoxDesign table
app.post('/boxdesign', async (req, res) => {
  try {
    const result = await pool.query('SELECT * FROM BoxDesign');
    res.json(result.rows);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// Add BoxDesign data
app.post('/boxdesign/add', async (req, res) => {
  const { content, row_num, col_num, value } = req.body;
  try {
    const result = await pool.query(
      'INSERT INTO BoxDesign (content, row_num, col_num, value) VALUES ($1, $2, $3, $4) RETURNING *',
      [content, row_num, col_num, value]
    );
    res.json(result.rows[0]);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// POST route to update a BoxDesign by id
app.post('/boxdesign/update/:id', async (req, res) => {
  const { id } = req.params;
  const { content, row_num, col_num, value } = req.body;
  try {
    const result = await pool.query(
      'UPDATE BoxDesign SET content = $1, row_num = $2, col_num = $3, value = $4 WHERE id = $5 RETURNING *',
      [content, row_num, col_num, value, id]
    );
    res.json(result.rows[0]);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});


// Delete BoxDesign data
app.delete('/boxdesign/:id', async (req, res) => {
  const { id } = req.params;
  try {
    const result = await pool.query('DELETE FROM BoxDesign WHERE id = $1', [id]);
    if (result.rowCount === 0) {
      return res.status(404).json({ error: 'BoxDesign not found' });
    }
    res.status(204).send();
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});


// POST route to fetch data from CorrugatedMachines table
app.post('/corrugatedmachines', async (req, res) => {
  try {
    const result = await pool.query('SELECT * FROM CorrugatedMachines');
    res.json(result.rows);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// POST route to insert data into CorrugatedMachines table
app.post('/corrugatedmachines/add', async (req, res) => {
  const { content, col_1, col_2, col_3, col_4 } = req.body;
  try {
    const result = await pool.query(
      'INSERT INTO CorrugatedMachines (content, col_1, col_2, col_3, col_4) VALUES ($1, $2, $3, $4, $5) RETURNING *',
      [content, col_1, col_2, col_3, col_4]
    );
    res.json(result.rows[0]);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// POST route to update data in CorrugatedMachines table
app.post('/corrugatedmachines/update/:id', async (req, res) => {
  const { id } = req.params;
  const { content, col_1, col_2, col_3, col_4 } = req.body;
  try {
    const result = await pool.query(
      'UPDATE CorrugatedMachines SET content = $1, col_1 = $2, col_2 = $3, col_3 = $4, col_4 = $5 WHERE id = $6 RETURNING *',
      [content, col_1, col_2, col_3, col_4, id]
    );
    if (result.rowCount === 0) {
      return res.status(404).json({ error: 'Machine not found' });
    }
    res.json(result.rows[0]);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// POST route to delete data from CorrugatedMachines table
app.post('/corrugatedmachines/delete', async (req, res) => {
  const { id } = req.body;
  try {
    const result = await pool.query('DELETE FROM CorrugatedMachines WHERE id = $1', [id]);
    if (result.rowCount === 0) {
      return res.status(404).json({ error: 'Machine not found' });
    }
    res.status(204).send();
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

app.listen(port, () => {
  console.log(`Server is running on http://localhost:${port}`);
});

//update conversion cost
app.put('/conversioncost/:id', async (req, res) => {
  const { id } = req.params;
  const { 
    "Select the cost basis": select_cost_basis, 
    unit, 
    corrugator_1_3ply, 
    corrugator_1_5ply, 
    corrugator_2_3ply, 
    corrugator_2_5ply, 
    corrugator_3_3ply, 
    corrugator_3_5ply 
  } = req.body;
  try {
    const result = await pool.query(
      'UPDATE ConversionCost SET "Select the cost basis" = $1, unit = $2, corrugator_1_3ply = $3, corrugator_1_5ply = $4, corrugator_2_3ply = $5, corrugator_2_5ply = $6, corrugator_3_3ply = $7, corrugator_3_5ply = $8 WHERE id = $9 RETURNING *',
      [select_cost_basis, unit, corrugator_1_3ply, corrugator_1_5ply, corrugator_2_3ply, corrugator_2_5ply, corrugator_3_3ply, corrugator_3_5ply, id]
    );
    if (result.rowCount === 0) {
      return res.status(404).json({ error: 'ConversionCost not found' });
    }
    res.json(result.rows[0]);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});


//fetch data conversion cost
app.post('/conversioncost', async (req, res) => {
  try {
    const result = await pool.query('SELECT * FROM ConversionCost');
    res.json(result.rows);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});


// Add ConversionCost data
app.post('/conversioncost/add', async (req, res) => {
  const { 
    "Select the cost basis": select_cost_basis, 
    unit, 
    corrugator_1_3ply, 
    corrugator_1_5ply, 
    corrugator_2_3ply, 
    corrugator_2_5ply, 
    corrugator_3_3ply, 
    corrugator_3_5ply 
  } = req.body;
  try {
    const result = await pool.query(
      'INSERT INTO ConversionCost ("Select the cost basis", unit, corrugator_1_3ply, corrugator_1_5ply, corrugator_2_3ply, corrugator_2_5ply, corrugator_3_3ply, corrugator_3_5ply) VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING *',
      [select_cost_basis, unit, corrugator_1_3ply, corrugator_1_5ply, corrugator_2_3ply, corrugator_2_5ply, corrugator_3_3ply, corrugator_3_5ply]
    );
    res.json(result.rows[0]);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// Delete ConversionCost data
app.delete('/conversioncost/:id', async (req, res) => {
  const { id } = req.params;
  try {
    const result = await pool.query('DELETE FROM ConversionCost WHERE id = $1', [id]);
    if (result.rowCount === 0) {
      return res.status(404).json({ error: 'ConversionCost not found' });
    }
    res.status(204).send();
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// POST route to fetch data from PrintingCost table
app.post('/printingcost', async (req, res) => {
  try {
    const result = await pool.query('SELECT * FROM PrintingCost');
    console.log(result.rows); // Log the fetched rows
    res.json(result.rows);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// Add PrintingCost data
app.post('/printingcost/add', async (req, res) => {
  const { printing_cost_details, col_1 } = req.body;
  try {
    const result = await pool.query(
      'INSERT INTO PrintingCost ("Printing Cost details, Rs / m²", col_1) VALUES ($1, $2) RETURNING *',
      [printing_cost_details, col_1]
    );
    res.json(result.rows[0]);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// post route to update data into printingcost table
app.post('/printingcost/update/:id', async (req, res) => {
  const { id } = req.params;
  const { printing_cost_details_rs_per_m2, col_1 } = req.body;
  try {
    const result = await pool.query(
      'UPDATE PrintingCost SET "Printing Cost details, Rs / m²" = $1, col_1 = $2 WHERE id = $3 RETURNING *',
      [printing_cost_details_rs_per_m2, col_1, id]
    );
    console.log(result.rows[0]); // Log the updated row
    res.json(result.rows[0]);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// Delete PrintingCost data
app.delete('/printingcost/:id', async (req, res) => {
  const { id } = req.params;
  try {
    const result = await pool.query('DELETE FROM PrintingCost WHERE id = $1', [id]);
    if (result.rowCount === 0) {
      return res.status(404).json({ error: 'PrintingCost not found' });
    }
    res.status(204).send();
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});


// POST route to fetch data from ManageCustomer table
app.post('/customers', async (req, res) => {
  try {
    const result = await pool.query('SELECT * FROM ManageCustomer');
    res.json(result.rows);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// Fetch all customers
app.post('/customers', async (req, res) => {
  try {
    const result = await pool.query('SELECT * FROM ManageCustomer');
    res.json(result.rows);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// Add a new customer
app.post('/customers/add', async (req, res) => {
  const { customer_code, company_name, rating, contact_person, phone_no, email } = req.body;
  try {
    const result = await pool.query(
      'INSERT INTO ManageCustomer (customer_code, company_name, rating, contact_person, phone_no, email) VALUES ($1, $2, $3, $4, $5, $6) RETURNING *',
      [customer_code, company_name, rating, contact_person, phone_no, email]
    );
    res.json(result.rows[0]);
  } catch (err) {
    console.error('Error adding customer:', err.message);
    res.status(500).send('Server Error');
  }
});

// Update customer
app.post('/customers/update', async (req, res) => {
  const { customer_code, company_name, rating, contact_person, phone_no, email } = req.body;
  try {
    const result = await pool.query(
      'UPDATE ManageCustomer SET company_name = $2, rating = $3, contact_person = $4, phone_no = $5, email = $6 WHERE customer_code = $1 RETURNING *',
      [customer_code, company_name, rating, contact_person, phone_no, email]
    );
    if (result.rowCount === 0) {
      return res.status(404).json({ error: 'Customer not found' });
    }
    res.json(result.rows[0]);
  } catch (err) {
    console.error('Error updating customer:', err.message);
    res.status(500).send('Server Error');
  }
});

// Delete customer
app.post('/customers/delete', async (req, res) => {
  const { customer_code } = req.body;
  try {
    const result = await pool.query('DELETE FROM ManageCustomer WHERE customer_code = $1', [customer_code]);
    if (result.rowCount === 0) {
      return res.status(404).json({ error: 'Customer not found' });
    }
    res.status(204).send();
  } catch (err) {
    console.error('Error deleting customer:', err.message);
    res.status(500).send('Server Error');
  }
});

// POST route to fetch data from ManageEmployee table
app.post('/employees', async (req, res) => {
  try {
    const result = await pool.query('SELECT * FROM ManageEmployee');
    res.json(result.rows);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// POST route to insert data into ManageEmployee table
app.post('/employees/add', async (req, res) => {
  const { employee_code, employee_name, phone_no, email } = req.body;
  try {
    const result = await pool.query(
      'INSERT INTO ManageEmployee (employee_code, employee_name, phone_no, email) VALUES ($1, $2, $3, $4) RETURNING *',
      [employee_code, employee_name, phone_no, email]
    );
    res.json(result.rows[0]);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// PUT route to update an employee by id
app.put('/employees/:id', async (req, res) => {
  const { id } = req.params;
  const { employee_code, employee_name, phone_no, email } = req.body;
  try {
    const result = await pool.query(
      'UPDATE ManageEmployee SET employee_code = $1, employee_name = $2, phone_no = $3, email = $4 WHERE id = $5 RETURNING *',
      [employee_code, employee_name, phone_no, email, id]
    );
    if (result.rows.length === 0) {
      return res.status(404).json({ error: 'Employee not found' });
    }
    res.json(result.rows[0]);
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// DELETE route to delete an employee by id
app.delete('/employees/:id', async (req, res) => {
  const { id } = req.params;
  try {
    const result = await pool.query('DELETE FROM ManageEmployee WHERE id = $1', [id]);
    if (result.rowCount === 0) {
      return res.status(404).json({ error: 'Employee not found' });
    }
    res.status(204).send();
  } catch (err) {
    console.error(err.message);
    res.status(500).send('Server Error');
  }
});

// Fetch Customer Details
app.post('/customerdetails', async (req, res) => {
  try {
    const result = await pool.query('SELECT * FROM Customer_details');
    res.json(result.rows);
  } catch (err) {
    console.error('Error fetching customer details:', err.message);
    res.status(500).send('Server Error');
  }
});

// Add Customer Detail
app.post('/customerdetails/add', async (req, res) => {
  const { sales_person_code, customer, customer_rating, design_offer_code, job_description, order_quantity, box_price } = req.body;
  try {
    const result = await pool.query(
      'INSERT INTO Customer_details (sales_person_code, customer, customer_rating, design_offer_code, job_description, order_quantity, box_price) VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING *',
      [sales_person_code, customer, customer_rating, design_offer_code, job_description, order_quantity, box_price]
    );
    res.json(result.rows[0]);
  } catch (err) {
    console.error('Error adding customer detail:', err.message);
    if (err.code === '23505') { // Unique violation
      res.status(400).send('Duplicate sales_person_code');
    } else {
      res.status(500).send('Server Error');
    }
  }
});

// Update Customer Detail
app.post('/customerdetails/update', async (req, res) => {
  const { original_sales_person_code, sales_person_code, customer, customer_rating, design_offer_code, job_description, order_quantity, box_price } = req.body;
  try {
    const result = await pool.query(
      'UPDATE Customer_details SET sales_person_code = $2, customer = $3, customer_rating = $4, design_offer_code = $5, job_description = $6, order_quantity = $7, box_price = $8 WHERE sales_person_code = $1 RETURNING *',
      [original_sales_person_code, sales_person_code, customer, customer_rating, design_offer_code, job_description, order_quantity, box_price]
    );
    if (result.rowCount === 0) {
      return res.status(404).json({ error: 'Customer not found' });
    }
    res.json(result.rows[0]);
  } catch (err) {
    console.error('Error updating customer detail:', err.message);
    res.status(500).send('Server Error');
  }
});





// Delete Customer Detail
app.post('/customerdetails/delete', async (req, res) => {
  const { id } = req.body;
  try {
    const result = await pool.query('DELETE FROM Customer_details WHERE sales_person_code = $1', [id]);
    if (result.rowCount === 0) {
      return res.status(404).json({ error: 'Customer not found' });
    }
    res.status(204).send();
  } catch (err) {
    console.error('Error deleting customer detail:', err.message);
    res.status(500).send('Server Error');
  }
});













